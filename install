#!/usr/bin/env bash

# !!! requires root !!!

set -e

# terminal colors
# background: #0E2E20
# foreground: #29E18C

# packages
echo "Installing apt packages..."
apt-get update -y
apt-get install -y --no-install-recommends \
    build-essential \
    apt-transport-https \
    ca-certificates \
    linux-image-extra-$(uname -r) \
    python3-dev \
    python-dev \
    python3-pip \
    python3-venv \
    libncurses5-dev \
    libx11-dev \
    libxt-dev \
    ruby \
    ruby-dev \
    curl \
    tmux \
    tree \
    locate

# docker
echo "Installing docker..."
apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
echo "deb https://apt.dockerproject.org/repo ubuntu-xenial main" > /etc/apt/sources.list.d/docker.list
apt-get update
apt-get purge lxc-docker
apt-cache policy docker-engine
apt-get install -y --no-install-recommends docker-engine
service docker start
docker run --rm hello-world
docker rmi hello-world
usermod -aG docker logan
systemctl enable docker

# rust
echo "Installing rust..."
curl -sSf https://static.rust-lang.org/rustup.sh | sh

# go
echo "Installing go..."
VERSION=1.6.2 && OS=linux && ARCH=amd64
curl -O https://storage.googleapis.com/golang/go$VERSION.$OS-$ARCH.tar.gz
tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> /etc/profile

# node.js
echo "Installing node.js..."
curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
apt-get install -y nodejs
npm install npm -g

# python
echo "Installing python packages..."
pip3 install flake8 flake8-docstrings

# bashrc
echo "Configuring bash aliases..."
cp ./bashrc_aliases ~/.bashrc_aliases
echo "source ~/.bashrc_aliases" >> ~/.bashrc

# git
echo "Configuring git..."

cp ./gitconfig ~/.gitconfig
cp ./git-prompt.sh ~/.git-prompt.sh

# tmux
echo "Configuring tmux..."
git clone https://github.com/erikw/tmux-powerline.git ~/git/tmux-powerline/
cp ./tmux.conf ~/.tmux.conf
cp ./tmux-powerlinerc ~/.tmux-powerlinerc

# vim
echo "Installing vim..."
git clone https://github.com/vim/vim.git ~/git/vim/
CUR_DIR=$PWD
cd ~/git/vim/
./configure --with-features=huge \
            --enable-multibyte \
            --enable-rubyinterp \
            --enable-python3interp \
            --with-python3-config-dir=/usr/lib/python3.5/config-3.5m-x86_64-linux-gnu \
            --enable-perlinterp \
            --enable-luainterp \
            --enable-cscope \
            --with-x \
            --with-compiledby="Logan Brooke" \
            --prefix=/usr
make VIMRUNTIMEDIR=/usr/share/vim/vim74
make install
vim --version
cd $CUR_DIR

echo "Configuring vim..."
cp ./vimrc ~/.vimrc
cp -r ./vim ~/.vim

echo "Installing vim plugins..."
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
vim +PluginInstall +qall
CUR_DIR=$PWD
cd ~/.vim/bundle/YouCompleteMe
./install.py --racer-completer --tern-completer --gocode-completer --clang-completer
cd $CUR_DIR

# misc
echo "Installing powerline fonts..."
git clone https://github.com/powerline/fonts.git ~/git/fonts
CUR_DIR=$PWD
cd ~/git/fonts
./install.sh
cd $CUR_DIR
echo "Fonts installed. Manual selection required in Unity Tweak Tool..."

echo "Installing Paper Theme and Icons..."
add-apt-repository ppa:snwh/pulp
apt-get update
apt-get install paper-icon-theme
apt-get install paper-gtk-theme
apt-get install paper-cursor-theme
echo "Theme installed. Manual selection required in Unity Tweak Tool..."

echo "Please log out and back in for all changes to take effect"
echo "Installation Complete!"
